# Vulnerability Score consists of 5 parameters.
# Residence (Map of zip codes with weightage.
# Salary (Number)
# Dependents (Number of dependent people. More dependents, more vulnerable)
# Check-ins (Number of places where a person visits. Parameter is a list of strings)
# Age (Number)
import random
# TODO Increase number of areas and deteremine scaling factor after all parameters and elements are fixed

# Map of area codes with weightage. Highest number for the costliest area.
residence_map = {
    90007: 7,  # USC Area
    90031: 9,  # Beverly Hills
    90017: 8,  # Downtown LA
    91001: 7,  # Pasadena
    90291: 8,  # Santa Monica
    0:  0,
}

# Priorities parameter wise with highest number as higher priority
priorities = {'Residence': 5, 'Salary': 4, 'Check-ins': 3, 'Dependents': 2, 'Age': 1}

# TODO Fetch from DB after recognizing a face to be implemented here


def fetch_data():
    age = 26
    checkins = {"Jinya Ramen bar", "DisneyLand", "Hollywood walk of Fame", "West field Century City Mall"}
    salary = 110000
    dependents = 0
    residence = 90007
    # age = 0
    # checkins = {}
    # salary = 0
    # dependents = 0
    # residence = 0

    return residence, salary, dependents, checkins, age

# Assigning a priority numerically for range of salary
def find_salary_range(sal):

    if sal > 0 and sal < 25000:
        normalized_sal = 1
    elif sal >= 25000 and sal < 50000:
        normalized_sal = 2
    elif sal >= 50000 and sal < 100000:
        normalized_sal = 3
    elif sal >= 100000 and sal < 120000:
        normalized_sal = 4
    elif sal >= 120000 and sal < 140000:
        normalized_sal = 5
    elif sal >= 140000 and sal < 160000:
        normalized_sal = 6
    elif sal >= 160000 and sal < 200000:
        normalized_sal = 7
    elif sal >= 200000 and sal < 300000:
        normalized_sal = 8
    elif sal >= 300000 and sal < 500000:
        normalized_sal = 9
    else:
        normalized_sal = 10

    return normalized_sal

# Assigning a priority numerically for range of ages

def find_age_range(age):

    if age > 0 and age < 20:
        normalized_age = 4
    elif age >= 20 and age < 25:
        normalized_age = 6
    elif age >= 25 and age < 30:
        normalized_age = 8
    elif age >= 30 and age < 35:
        normalized_age = 9
    elif age >= 35 and age < 40:
        normalized_age = 7
    elif age >= 40 and age < 50:
        normalized_age = 5
    else:
        normalized_age = 3

    return normalized_age


def calculate_score(res, salary, dependents, checkins, age):
    score = 0
    score += priorities.get('Age') * find_age_range(age)
    len_checkins = len(checkins)
    if len_checkins > 5:
        len_checkins = 5
    score += priorities.get('Check-ins') * len_checkins
    score += priorities.get('Dependents') * dependents
    score += priorities.get('Salary') * find_salary_range(salary)
    score += priorities.get('Residence') * residence_map[res]

    return score


if __name__ == '__main__':


    res, salary, dependents, checkins, age = fetch_data()
    if res == salary == dependents == len(checkins) == age == 0:
        score = random.randrange(25, 35, 1)
    else:
        score = calculate_score(res, salary, dependents, checkins, age)
    print('Vulnerability Score = ' + str(score))
